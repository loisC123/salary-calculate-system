# 💼 Salary Calculation Tool｜薪資計算工具

本工具旨在協助自動化統計每日代班記錄，計算平日與假日加班時數，並生成五張可供人工核對與薪資轉交的報表。  
特別適用於班表彈性、轉場頻繁、人工統計繁瑣的作業環境。

---

## ✨ 功能特色

- 📅 自動統計每日所有 BA 轉場紀錄
- 🧮 依據工作日與假日規則，自動分類加班級距
- 📊 精準計算 BA 與 GA/SC 的時數／次數與應得薪資
- 🔁 支援代班轉交，產出對應薪資扣補報表
- 📤 一鍵匯出五張報表（Excel）

---

## 📋 功能總覽

| 項目           | 說明                                                                 |
|----------------|----------------------------------------------------------------------|
| 原始資料處理     | 讀取照顧員的服務資料（如 `20250706.xls`），解析 ROC 7 碼日期與起訖時間，轉為 `datetime` 對象 |
| 轉場原始資料處理  | 讀取代班的資料（ `cover.xls`），欄位：原員工、代班員工、個案姓名、服務日期(民國7碼) |
| 假日判斷邏輯     | 根據 `holidays` 列表（MM/DD 格式）與週六日自動視為假日                                  |
| BA 工時分析      | 每筆 `BA` 服務項目每日累加工時，並依時數區間分類為普通／加班／假日工時計算                    |
| BA 轉場統計      | 同一員工同一日多筆 BA 服務：第一筆算一次轉場，後續如服務間隔 > 1 分鐘，則另計轉場一次         |
| GA / SC 統計     | 根據「數量(整數)」累加 GA / SC 項目次數，並乘以單次薪資計算總額                          |
| 五張報表         | 匯出 Excel：1. BA時數表、2. BA工時表、3. GA/SC表、4. BA代班薪資轉交、5. GA_SC代班薪資轉交   |

---

## 🧠 程式邏輯概念

### 🔧 1. 主程式：`main_salary_calc.py`

#### 🎯 功能
統計 BA 與 GA/SC 員工的實際工時、加班時數、轉場數、薪資，並依據代班設定產出「代班薪資轉交」報表。

#### 📂 輸入檔案
- `照顧_YYYYMMDD.xls`：每日照顧服務資料（含員工、服務時間、項目、個案）
- `cover.xlsx`：代班設定表（原員工、代班員工、服務日期、個案姓名）

#### 📄 輸出報表
產出 `時數統計_YYYYMMDD_HHmm.xlsx` 檔案，含五張 Excel 工作表：

1. **BA時數表**：每人平日/加班/假日工時、轉場數與預估薪資  
2. **BA工時表**：每日個案的工作時數分佈與合計  
3. **GA_SC表**：GA/SC 項目數量與應領薪資  
4. **BA代班薪資轉交**：代班者應得之時數／薪資（含平日、假日、轉場費）  
5. **GA_SC代班薪資轉交**：代班者應得之 GA/SC 次數與薪資  

---

### 🔍 2. 工時計算邏輯

#### 🟡 BA 時數與加班級距邏輯

| 類別            | 條件                 | 欄位名稱         | 計算公式                   |
|------------------|----------------------|------------------|-----------------------------|
| 平日 ×1           | 工時 ≤ 480 分         | `emp_ba_p1`      | 工時 ÷ 60                   |
| 平日加班 ×1.34    | 480 < 工時 ≤ 600 分   | `emp_ba_p1_34`   | (工時 − 480) ÷ 60           |
| 平日加班 ×1.67    | 工時 > 600 分         | `emp_ba_p1_67`   | (工時 − 600) ÷ 60           |
| 假日 ×2           | 假日（含週六日與 holiday）| `emp_ba_p2`      | 工時 ÷ 60                   |
| 轉場費用           | 每日第一筆 + 相鄰 gap > 1 分鐘 | `trans_count` | 每次 35 元                  |

---

#### 🟡 GA/SC 計算邏輯

| 項目 | 規則與說明                        |
|------|----------------------------------|
| 單價 | 每筆數量 × 650 元                |
| 數量預設 | 若欄位為空，預設數量為 1         |
| 轉場 | GA/SC 不計入轉場費               |

---

### 🧩 3. 模組：`cover_utils.py`

#### 🎯 功能
解析 `cover.xlsx` 中的代班設定，並將符合條件的服務時數／薪資由原員工轉交給代班者，產出對應報表。

#### 📥 輸入
- `df`：處理後的照顧資料（含起訖時間、員工、個案、服務項目）
- `cover_mapping`：從 cover.xlsx 載入的 dict（key = (原員工, 個案, 日期)，value = 代班員工）
- `holidays`：假日列表（格式：['07/06', '07/07', ...]）

#### 📤 輸出
- `ba_cover_df`：BA 代班薪資轉交資料表
- `ga_cover_df`：GA/SC 代班薪資轉交資料表

#### 🧠 核心邏輯

| 功能                 | 說明                                                                                   |
|----------------------|----------------------------------------------------------------------------------------|
| 📥 讀取代班表           | 匯入代班設定 `(原員工, 個案姓名, 日期)` → `代班員工` 映射                              |
| 👥 BA代班薪資轉交      | 符合條件者：該筆 BA 時數由原員工轉交給代班者，並依平日／假日薪資級距獨立計算             |
| 👥 GA_SC代班薪資轉交   | GA / SC 項目符合代班條件者：數量與薪資轉交給代班者                                    |
| 📎 保留原始統計         | 所有原始報表仍以原服務人員為統計主體，便於對照及人工覆核                             |
| 📄 額外產出兩報表       | `BA代班薪資轉交` 與 `GA_SC代班薪資轉交`，顯示轉交前後差異與薪資金額                     |

---

## 🚀 快速開始

```bash
# 1. Clone 本專案
git clone https://github.com/loisC123/salary_calc.git
cd salary_calc

# 2. 安裝依賴套件
pip install -r requirements.txt

# 3. 執行主程式
python main_salary_calc.py
```

#### 📎 使用注意事項
- 執行結果將輸出至 output/ 資料夾，檔名格式如 時數統計_20250709_1530.xlsx

- 若需進行扣款與補發，請以 BA代班薪資轉交 與 GA_SC代班薪資轉交 為依據人工核對

- 若未來希望「直接更改主報表中的服務者姓名」，可開啟額外參數控制，目前預設保留原員工統計

- 若跨月份作業，請調整欄位標題與輸出檔案格式（如從 6/{i} 改為 7/{i}）

#### 📌 TODO／未來規劃
 - 載入國定假日 API 或 YAML 以進行精準判斷

 - 加入圖形化報表（如柱狀圖、日曆熱力圖）

 - 提供 Web UI 操作介面（例如 Streamlit 或 Flask）
